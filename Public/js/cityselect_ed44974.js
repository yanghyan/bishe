define("merchants:widget/settled/position/citySelect/citySelect.js",function(require,exports,module){function CitySelect(t){t.html(CITY_WRAP_TMPL()),this.wrap=t,this.$cityWrap=t.find("[data-node=allCityList]"),this.$cityInput=t.find("[data-node=selectCity]"),this.rendered=!1,this.province={name:"",id:""},this.city={name:"",id:"",is_open:"0"},this.rendered=!1,this.errMsg="请选择省份与城市",this.arrowDown=t.find("[data-node=arrowDown]"),this.init(),this.initEvent()}var CITY_SELECT_TMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="cityNavHead">    <div class="cityNav province curr" data-type="province">省份</div>    <div class="cityNav city" data-type="city">城市</div></div><div class="cityContent">    <div class="content province curr">暂无数据，加载中</div>    <div class="content city">暂无数据，请选择省份</div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],CITY_LIST_TMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("");for(var keys in data){_template_fun_array.push('    <div class="city-row">        <div class="keys">',"undefined"==typeof keys?"":baidu.template._encodeHTML(keys),'</div>        <div class="cities">            ');for(var i=0;i<data[keys].length;i++){_template_fun_array.push("                ");var d=data[keys][i];_template_fun_array.push('                <li data-id="',"undefined"==typeof d.id?"":baidu.template._encodeHTML(d.id),'" data-isopen="',"undefined"==typeof d.is_open?"":baidu.template._encodeHTML(d.is_open),'" >',"undefined"==typeof d.city_name.split("-")[1]?"":baidu.template._encodeHTML(d.city_name.split("-")[1]),"</li>            ")}_template_fun_array.push("        </div>    </div>")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],CITY_WRAP_TMPL=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<input type="text" placeholder="选择餐厅所在城市" name="city" maxlength="20"data-node="selectCity" readonly/><ul class="cityList" data-node="allCityList"></ul><i class="arrowDown" data-node="arrowDown"><img src=',baidu.template._encodeHTML("//staticb.waimai.baidu.com/static/merchants/images/announce/down_12079ec.jpg"),"></i>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],CITIES_URL={province:"/wmbos/bizpc/provinceList",city:"/wmbos/bizpc/citylist"};CitySelect.prototype={init:function(){this.wrap.addClass("widget-merchants-settled-city-select"),this.$cityWrap.html(CITY_SELECT_TMPL())},initEvent:function(){var t=this;this.arrowDown.bind("click",function(e){t.toggle(),e.stopPropagation()}),this.$cityWrap.bind("click",function(t){t.stopPropagation()}),this.$cityWrap.find(".cityNavHead").delegate(".cityNav","click",function(){var e=$(this),a=e.attr("data-type");t.toggleNav(a)}),this.$cityWrap.find(".content").delegate("li","click",function(e){var a=$(e.delegateTarget),i=$(this),n=i.attr("data-id"),r=i.text();if(!i.is(".curr"))if(a.find("li").removeClass("curr"),i.addClass("curr"),a.is(".province"))t.renderContent("city",{province_id:n}),t.toggleNav("city"),t.setInputValue(r,n,!1,"province"),t.openCityHandler(!1,"",r);else if(a.is(".city")){var c=i.attr("data-isopen");t.setInputValue(r,n,c,"city"),t.$cityWrap.hide(),t.openCityHandler("1"==c?!0:!1,n,r)}})},openCityHandler:function(t,e,a){listener.trigger("position","selectcity",{is_open:t,city_id:e,city:a})},setInputValue:function(t,e,a,i){this[i]={name:t,id:e},"province"==i?this.city={name:"",id:"",is_open:!1}:"city"==i&&(this.city.is_open=a),this.$cityInput.val(this.province.name+"-"+this.city.name)},toggle:function(){this.rendered||(this.renderContent("province"),this.rendered=!0),this.$cityWrap.toggle()},hideSelection:function(){this.$cityWrap.hide()},toggleNav:function(t){this.$cityWrap.find(".cityNav").removeClass("curr").filter("."+t).addClass("curr"),this.$cityWrap.find(".content").removeClass("curr").filter("."+t).addClass("curr")},renderContent:function(t,e){var a=CITIES_URL[t],i=this;$.ajax({url:a,dataType:"json",data:e,success:function(e){0==e.errno&&i.renderData(e.data,t)}})},renderData:function(t,e){var a=this,t=a.rangeData(t[e+"_list"],e),i=this.$cityWrap.find(".content."+e);i.html(CITY_LIST_TMPL({data:t}))},rangeData:function(t,e){var a={ABCDE:[],FGHIJ:[],KLMNO:[],PQRST:[],UVWXYZ:[]};for(var i in a)for(var n=0;n<i.length;n++){var r=i[n];if(t.hasOwnProperty(r))for(var c=0;c<t[r].length;c++){var _=t[r][c];_.id=_[e+"_id"],a[i].push(t[r][c])}}return a},validate:function(){return!!this.city.name},getData:function(){var t=this;return{city_id:t.city.id,city:t.city.name,is_open:t.city.is_open}}},module.exports=CitySelect});