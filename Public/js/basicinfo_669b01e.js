define("merchants:widget/settled/basicinfo/basicinfo.js",function(require,exports,module){var aptitude=require("merchants:widget/settled/basicinfo/aptitude-description.js"),descTmpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push("<table>    <tr>        <th>一级分类</th>        <th>二级分类</th>        <th>包含证件</th>    <tr>    ");for(var firstLevel in data){_template_fun_array.push("        ");var firstLevelSpan=0,initialized=!1;if(_template_fun_array.push("        "),"[object Array]"==Object.prototype.toString.call(data[firstLevel])){_template_fun_array.push("                ");for(var i=0;i<data[firstLevel].length;i++)_template_fun_array.push("                    <tr>                        "),initialized||(_template_fun_array.push('                            <td rowspan="',"undefined"==typeof data[firstLevel].length?"":baidu.template._encodeHTML(data[firstLevel].length),'" colspan="2">                                ',"undefined"==typeof firstLevel?"":baidu.template._encodeHTML(firstLevel),"                            </td>                            "),initialized=!0,_template_fun_array.push("                        ")),_template_fun_array.push("                        <td>","undefined"==typeof data[firstLevel][i]?"":baidu.template._encodeHTML(data[firstLevel][i]),"</td>                    </tr>                ");_template_fun_array.push("        ")}else{_template_fun_array.push("            ");for(var secondLevel in data[firstLevel])_template_fun_array.push("                "),firstLevelSpan+=data[firstLevel][secondLevel].length,_template_fun_array.push("            ");_template_fun_array.push("            ");for(var secondLevel in data[firstLevel]){_template_fun_array.push("                ");for(var i=0;i<data[firstLevel][secondLevel].length;i++)_template_fun_array.push("                    <tr>                        "),initialized||(_template_fun_array.push('                            <td rowspan="',"undefined"==typeof firstLevelSpan?"":baidu.template._encodeHTML(firstLevelSpan),'">                                ',"undefined"==typeof firstLevel?"":baidu.template._encodeHTML(firstLevel),"                            </td>                            "),initialized=!0,_template_fun_array.push("                        ")),_template_fun_array.push("                        "),0==i&&_template_fun_array.push('                            <td rowspan="',"undefined"==typeof data[firstLevel][secondLevel].length?"":baidu.template._encodeHTML(data[firstLevel][secondLevel].length),'">                                ',"undefined"==typeof secondLevel?"":baidu.template._encodeHTML(secondLevel),"                            </td>                        "),_template_fun_array.push("                        <td>","undefined"==typeof data[firstLevel][secondLevel][i]?"":baidu.template._encodeHTML(data[firstLevel][secondLevel][i]),"</td>                    </tr>                ");_template_fun_array.push("            ")}_template_fun_array.push("        ")}_template_fun_array.push("    ")}_template_fun_array.push("</table>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],cauTmpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="caution-dialog"><i class="caution-cancle" data-node="caution-cancle"></i>'),_template_fun_array.push(0==data.errno?'<div class="logo-img success"></div>':'<div class="logo-img error "></div>'),_template_fun_array.push("<p>","undefined"==typeof data.errmsg?"":baidu.template._encodeHTML(data.errmsg),"</p>"),_template_fun_array.push(0==data.errno?'<a href="javascript:void(0);" class="caution-sure" data-node="cautionSureHide">确定</a>':'<a href="javascript:void(0);" class="caution-sure" data-node="cautionSure">确定</a>'),_template_fun_array.push("</div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],SUBMIT_AJAX="/wmbos/bizpc/merchant";module.exports=Widget.extend({el:".settled-basicinfo",events:{"click [data-node=formsubmit]":"onFormSubmit","change [data-node=aptitude_control] input[type=radio]":"toggleAptitudePanel","click [data-node=back_to_position]":"backToPosition","click [data-node=description]":"showAptitudeWindow",'click [data-node="aptitude_description"] .close':"hideAptitudeWindow"},channels:{"position finishpoi":"onSelectPOI","progress change":"onProgressChange"},init:function(){this.poiParam={},this.form=this.$el.find('[data-node="join_table"]'),this.aptitudeWrap=this.$dom.aptitude_description,this.initPics()},initPics:function(){this.$el.find(".pic-container").addClass("widget-settled-basicinfo-imageblock").uploadImg({width:150,height:125,title:"",url:"/wmbos/bizpc/uploadpic"})},toggleAptitudePanel:function(e){var t=$(e.target),a=this.$dom.aptitude_control.find("input[type=radio]").index(t);this.$dom.aptitude_panel.children().hide().eq(a).show()},onSelectPOI:function(e,t){this.poiParam=t,this.$el.show(),this.$el.find("[data-node=poi_name]").val(t.poi_name)},onFormSubmit:function(){var e=this;this.form.is(".unuse")||$.when(e.checkForm()).done(function(){var t=e.getFormData();$.ajax({url:SUBMIT_AJAX,type:"POST",dataType:"json",data:t,success:function(t){var a={errmsg:t.errmsg||"提交成功",errno:t.errno||0};0==t.errno?listener.trigger("progress","change",3,a):e.showCautionTip(a)},error:function(){alert("请检查网络")}})}).fail(function(t){e.putErrorToTip(t,1)})},checkForm:function(){for(var e,t,a,n,i=this,r=$.Deferred(),o=this.form.find('[data-node="half"]'),l=o.length,c=0,u=l;u>c;c++)if(e=o.eq(c),t=e.find("input").length?e.find("input").attr("data-check"):e.find("select").attr("data-check"),t&&(a=e.find("input").length?e.find("input").attr("data-errormsg"):e.find("select").attr("data-errormsg"),n=i.getInputValue(t),!i.checkChild(t,n)))return r.reject(a),r;var s=this.checkPicData();return s?(r.reject(s),r):(r.resolve(),r)},checkPicData:function(){var e=this.getPicData(),t=e.picData,a="";return t.shop_front_url?t.shop_env_url?e.no_business_license||t.business_license_url||t.restaurant_license_url||0!=t.other_license_url.length?"":a="请填写正确的资质信息！":a="请上传店内环境图":a="请上传店铺门脸图"},getPicData:function(){function e(e){return e.find("[data-node=imgUrl]").val()}var t={},a=this.$el.find("[data-node=no_license]").prop("checked");return this.$el.find(".pic-panel").each(function(a,n){var i=$(n),r=i.find(".pic-block"),o=i.data("pic-key"),l="";r.length>1?(l=[],$.each(r,function(t,a){var n=e($(a));n&&l.push(n)})):l=e(r),t[o]=l}),a&&(t.business_license_url="",t.other_license_url=[],t.restaurant_license_url=""),{picData:t,no_business_license:a}},checkChild:function(e,t){var a=this;switch(e){case"shop_name":if(!a.checkNull(t)&&!a.checkLength(t,20))return!1;break;case"shop_type":case"business_scope":case"delivery":case"business_license":if(!a.checkNull(t))return!1;break;case"city":if(!a.checkSelect(t))return!1;break;case"address":if(!a.checkNull(t)&&!a.checkLength(t,50))return!1;break;case"contact_man":if(!a.checkNull(t)&&!a.checkLength(t,20))return!1;break;case"contact_phone":if(!a.checkTelephone(t))return!1}return!0},checkNull:function(e){return null==e||""==e?!1:!0},checkLength:function(e,t){$.trim(e);return e.length>t||e.length<1?!1:!0},checkTelephone:function(e){return/^1[3|4|5|7|8][0-9]\d{8}$/.test(e)?!0:!1},checkSelect:function(e){return"请选择"==e?!1:!0},getInputValue:function(e){var t=$("[name='"+e+"']"),a=t[0].tagName.toLowerCase(),n=t.attr("type"),i=function(){var t=$(" input[name='"+e+"']").filter(":checked");return t.length?t.val():null},r=function(){return t.val()};switch(a){case"input":switch(n){case"radio":return i();default:return r()}break;case"select":return r();default:return null}},putErrorToTip:function(e,t){var a=this,n={errmsg:e,errno:t};a.showCautionTip(n)},getFormData:function(){for(var e=$('[data-node="half"]'),t={},a=this.getPicData(),n=0,i=e.length;i>n;n++){var r=e.eq(n),o=r.find("input").length?r.find("input").attr("name"):r.find("select").attr("name");t[o]=this.getInputValue(o)}return $.extend(t,this.poiParam),$.extend(t,a.picData),t},backToPosition:function(){listener.trigger("progress","change",1)},onProgressChange:function(e,t){2==t?this.$el.show():this.$el.hide()},showCautionTip:function(e){var t=this,a=cauTmpl({data:e});$('[data-node="cautionTip"]').html(a).show(),$('[data-node="caution-cancle"]').click(function(){$('[data-node="cautionTip"]').hide()}),$('[data-node="cautionSure"]').click(function(){$('[data-node="cautionTip"]').hide()}),$('[data-node="cautionSureHide"]').click(function(){$('[data-node="cautionTip"]').hide(),t.onhideDialog()})},showAptitudeWindow:function(){this.aptitudeWrap.show(),0==this.aptitudeWrap.find(".table-content").children().size()&&this.aptitudeWrap.find(".table-content").html(descTmpl({data:aptitude}))},hideAptitudeWindow:function(){this.aptitudeWrap.hide()}})});