var Slider=require("common:widget/ui/slider/slider.js"),sticky=require("common:widget/dep/moye/sticky.js"),template=require("common:widget/ui/template/template.js").template,etpl=require("common:widget/dep/etpl/main.js"),tplAjax=$("#sub-bottom").html(),scrollspy=require("common:widget/ui/scrollspy/scrollspy.js"),LazyLoad=require("common:widget/ui/lazyload/lazyload.js"),itemHover=require("list:widget/new_list/item.js");$(function(){function t(t,e,o){$("#"+t).html(template(e,o))}function e(){$("#j-t10logo-box").find(".t10-logo img").each(function(){var t,e,o=$(this);$("<img/>").attr("src",$(o).attr("src")).load(function(){t=this.width,e=this.height,t/140>e/75?$(o).css("width","140px").css("height","auto"):$(o).css("height","75px").css("width","auto")})})}function o(){var t=$("#j-ad-pointers");t.size()>0&&"none"===t.css("display")||require.async(["common:widget/ui/sliderbar/sliderbar.js"],function(t){new t({container:$("#j-rightAdContainer"),pageNumber:$("#j-ad-pointers a"),pageNumberHover:"hover",direction:"opacity",interval:5e3,callback:function(){this.pageNumber.hover(function(){$(this).trigger("click")})}})})}function a(){var t="#sticky-panel",e=$(t);if(e.length){scrollspy(t);var o=($(window).height()-e.height())/2;sticky(t,{top:o,bottomGap:270}),e.find("a").on("click",function(t){var e=$(this),o=e.attr("href");$("html, body").animate({scrollTop:$(o).offset().top},500),t.preventDefault()})}}function i(t,e,o){"undefined"==typeof o&&(o="click"),t.on(o,function(o){t.removeClass("active"),$(this).addClass("active"),e.hide();var a=t.index($(this));e.eq(a).show(),o.preventDefault()})}var n={container:$("#c-bottom"),render:function(t){this.container.html(etpl.compile(tplAjax)(t))}},l="/pcindex/index/indexhotajax",s="//t10.nuomi.com/pc/t10/ajaxt10deals?is_homepage=1",r="//t10.nuomi.com/pc/t10/ajaxt10deals?is_homepage=0&pn=20",c=location.protocol+"//"+location.hostname+":"+location.port+"/pcindex/index/indexbuttomlinkajax";$(".close-bottom-ad").click(function(){$(".bottom-ad").hide()});var d=($(window).width(),new Slider("j-sliders",{autoScroll:{interval:5e3,enable:!0},fx:{duration:100,type:"slide"},exposureLog:!0}));d.len>1&&(d.start(),$(".slide-holder").on({mouseenter:function(){d.stop(),$(".slide-prev").show(),$(".slide-next").show()},mouseleave:function(){d.start(),$(".slide-prev").hide(),$(".slide-next").hide()}})),$(".slide-next").on("click",function(t){d.moveRight(),t.preventDefault()}),$(".slide-prev").on("click",function(t){d.moveLeft(),t.preventDefault()}),a();var m=$("#j-location-list").children();m.eq(0).position().top!==m.eq(m.length-1).position().top?($(".all-locate").on({mouseenter:function(){$("#all-location-list").addClass("hover")}}),$("#all-location-list").on({mouseleave:function(){$(this).removeClass("hover")}})):$(".all-locate").hide();var p={getTimes:function(t,e){var o=e-t,a=Math.floor(o/864e5),i=o%864e5,n=Math.floor(i/36e5),l=i%36e5,s=Math.floor(l/6e4),r=l%6e4,c=Math.floor(r/1e3),d=function(t){return 10>1*t?"0"+t:t};return{day:a,hour:n,minutes:s,seconds:c,format:n+s+c>0?[d(n),d(s),d(c)].join(":"):"",min:n>0?60*n+s:s}},ajaxLoadHandler:function(e){if(0===e.errno){{var a=e.data,i=(a.sArr||{},a.hotRange),n=a.rightAd,l=a.hotTopic,s=a.adLowerRight;a.rankItems,a.visitItems&&a.visitItems.detail?a.visitItems.detail:[]}i?t("j-hotRange","tplHotRange",{list:i}):$("#j-hotRange .mid-list").append('<li class="dis-gray">无热门商圈</li>');var r=5;n instanceof Array&&n.length>0?(n.length>3&&(n.length=3),r-=n.length,t("j-rightAd","tplRightAd",{list:n}),o()):$("#j-rightAd").hide(),l instanceof Array&&l.length>0&&t("j-hotTopic","tplHotTopic",{list:l}),s instanceof Array&&s.length>0&&t("j-hotMall","tplHotMall",{list:s})}},getJingxuan:function(t){if(0===t.errno)if(t=t.data,t.t10Deals.total>3){var e=t.t10Deals.list;$("#j-jxContainer").html(template("tplJingxuan",{list:e,s:t.s_deals,st:"{s:"+t.s_deals+",tid:"+(t.t10Deals.tid?t.t10Deals.tid:"")+"}"})),p.countdown(t.t10Deals.period)}else window.isNoT10JingXuan=!0,$("#sticky-refer").hide()},getT10logo:function(t){if(0===t.errno)if(t=t.data,t.t10Deals.total>0){var o=p.getImageNum(t.t10Deals.list),a=template("tplT10logo",{list:t.t10Deals.list,imageNum:o});$("#j-t10logo-box").html(a)}else window.isNoT10JingXuan=!0,$("#sticky-refer").hide();e()},getT10NormalLogo:function(){$("#j-t10logo-box").html(template("tplT10logo",{imageNum:0}))},getT10JingxuanComplete:function(){window.t10JingxuanComplete=!0},getImageNum:function(t){var e=0;for(var o in t){var a=t[o];""!==a.na_logo&&e++}return e},countdown:function(t){var e=$("#j-jxTimer"),o=t.scene,a=t.periodIndex-1,i=o[a],n=null,l=o.length,s="",r="header-e",c="",d=new Date,m=o[0]&&o[0].starttime?o[0].starttime:"10:00:00";m=m.substr(0,m.indexOf(":"));var u=new Date(d.getFullYear(),d.getMonth(),d.getDate()+1,m).getTime(),g=setInterval(function(){n=(new Date).getTime(),s="",i?n>=i.StartTimeStamp&&n<=i.EndTimeStamp?(s=r,c=p.getTimes(n,i.EndTimeStamp).format):n>i.EndTimeStamp?(a+=1,i=o[a],i?c=p.getTimes(n,i.StartTimeStamp).format:a>=l?c=p.getTimes(n,u).format:clearInterval(g)):c=p.getTimes(n,i.StartTimeStamp).format:c=p.getTimes(n,u).format,c=c.split(":"),e.html(['<span class="t">',c[0],"</span>",'<span class="t">',c[1],"</span>",'<span class="t">',c[2],"</span>"].join(""));var t=e.parents(".top-title");""!==s?t.hasClass(r)||t.addClass(r):t.removeClass(r)},1e3)}};$.ajax(0===parseInt(F.context("isSACity"),10)?{type:"get",async:!1,url:s,dataType:"jsonp",jsonp:"jsonp_callback",jsonpCallback:"jsonp_callback",success:p.getJingxuan,complete:p.getT10JingxuanComplete}:{type:"get",url:r,dataType:"jsonp",jsonp:"jsonp_callback",jsonpCallback:"jsonp_callback",success:p.getT10logo,error:p.getT10NormalLogo,complete:p.getT10JingxuanComplete}),$.getJSON(l,p.ajaxLoadHandler),$.ajax({type:"get",url:c,dataType:"json",success:function(t){t.status||(n.render({data:t.data.list}),i($(".tab-nav li a"),$(".bottom-content"),"mouseenter"))}})});